@inherits LayoutComponentBase

<MudThemeProvider Theme="@AppTheme" IsDarkMode="@_isDarkMode" />
<MudPopoverProvider />
<MudDialogProvider />
<MudSnackbarProvider />

<MudLayout Class="@($"app-shell {(_isDarkMode ? "mode-dark" : "mode-light")}")">
    <MudAppBar Elevation="0" Dense="true" Class="main-appbar">
        <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="1" Class="brand-stack">
            <MudIcon Icon="@Icons.Material.Filled.QueryStats" Class="brand-icon" />
            <MudText Typo="Typo.h6">Probabilités Loto &amp; EuroMillions</MudText>
        </MudStack>

        <MudSpacer />

        <MudHidden Breakpoint="Breakpoint.MdAndDown">
            <MudStack Row="true" Spacing="1" Class="nav-actions">
                @foreach (var link in _navigationLinks)
                {
                    <MudButton Variant="Variant.Text" Color="Color.Inherit" Href="@link.Href" Class="nav-button">
                        @link.Label
                    </MudButton>
                }
            </MudStack>
        </MudHidden>

        <MudHidden Breakpoint="Breakpoint.LgAndUp">
            <MudMenu Icon="@Icons.Material.Filled.Menu">
                @foreach (var link in _navigationLinks)
                {
                    <MudMenuItem Href="@link.Href">@link.Label</MudMenuItem>
                }
            </MudMenu>
        </MudHidden>

        <MudHidden Breakpoint="Breakpoint.MdAndDown">
            <MudStack Row="true" Spacing="1" AlignItems="AlignItems.Center" Class="theme-toggle">
                <MudIcon Icon="@(_isDarkMode ? Icons.Material.Filled.Brightness4 : Icons.Material.Filled.Brightness7)"
                         Class="theme-toggle-icon" />
                <MudSwitch T="bool"
                           @bind-Value="_isDarkMode"
                           Color="Color.Warning"
                           Label="@ThemeModeLabel"
                           Class="theme-mode-switch" />
            </MudStack>
        </MudHidden>

        <MudHidden Breakpoint="Breakpoint.LgAndUp">
            <MudIconButton Icon="@(_isDarkMode ? Icons.Material.Filled.Brightness4 : Icons.Material.Filled.Brightness7)"
                           Color="Color.Inherit"
                           Size="Size.Medium"
                           OnClick="@ToggleThemeMode" />
        </MudHidden>
    </MudAppBar>

    <MudAlert Severity="Severity.Info" Variant="Variant.Outlined" Dense="true" Class="layout-disclaimer-top">
        Mode détente activé: couleurs, animations et statistiques. Les tirages restent purement équiprobables.
    </MudAlert>

    <MudMainContent Class="main-content">
        @Body
    </MudMainContent>

    <MudPaper Elevation="0" Class="layout-disclaimer-bottom">
        <MudText Typo="Typo.caption">
            Jeu responsable: les jeux d'argent comportent des risques (endettement, isolement, dépendance).
        </MudText>
    </MudPaper>
</MudLayout>

@code {
    private readonly IReadOnlyCollection<NavLinkDefinition> _navigationLinks =
    [
        new("/", "Accueil"),
        new("/grilles", "Générer"),
        new("/statistiques", "Statistiques"),
        new("/abonnement", "Abonnement"),
        new("/admin", "Admin")
    ];

    private static readonly MudTheme AppTheme = BuildTheme();
    private bool _isDarkMode;

    private string ThemeModeLabel => _isDarkMode ? "Nuit" : "Jour";

    private void ToggleThemeMode()
    {
        _isDarkMode = !_isDarkMode;
    }

    private static MudTheme BuildTheme() =>
        new()
        {
            PaletteLight = new PaletteLight
            {
                Primary = "#D14F2A",
                Secondary = "#1D7AFC",
                Info = "#11A39A",
                Success = "#1D9B4F",
                Warning = "#E6A317",
                Error = "#D94343",
                Background = "#FFF7E8",
                Surface = "#FFFFFF",
                AppbarBackground = "rgba(255, 255, 255, 0.9)",
                AppbarText = "#2D1F15",
                TextPrimary = "#2D1F15",
                TextSecondary = "#5C4D42",
                DrawerBackground = "#FFFFFF",
                DrawerText = "#2D1F15",
                DrawerIcon = "#5C4D42",
                LinesDefault = "#E8D7C2",
                TableLines = "#E8D7C2"
            },
            PaletteDark = new PaletteDark
            {
                Primary = "#FF8A4D",
                Secondary = "#6EA8FF",
                Info = "#42D1C5",
                Success = "#59C67A",
                Warning = "#FFD166",
                Error = "#FF7D7D",
                Background = "#151A2F",
                Surface = "#1D2440",
                AppbarBackground = "rgba(18, 24, 46, 0.9)",
                AppbarText = "#F6EDE3",
                TextPrimary = "#F6EDE3",
                TextSecondary = "#D6C7B8",
                DrawerBackground = "#1D2440",
                DrawerText = "#F6EDE3",
                DrawerIcon = "#D6C7B8",
                LinesDefault = "#2E3555",
                TableLines = "#2E3555"
            },
            LayoutProperties = new LayoutProperties
            {
                DefaultBorderRadius = "14px"
            }
        };

    private sealed record NavLinkDefinition(string Href, string Label);
}
